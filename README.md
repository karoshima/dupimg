# 重複画像処理ツール

このプロジェクトは、指定されたディレクトリ内にある重複画像を検出して管理するためのツールです。画像ライブラリの整理を効率化し、重複した画像を削除することでスペースを節約できます。

## 主な機能

### フロントエンド (UI)

- Webブラウザ上で動作する直感的な UI を提供します。
- 処理対象の画像と検出された重複画像を視覚的に表示します。
- 削除・移動・ハードリンクすべき対象画像を簡単に検出し、対処できます。

### バックエンド

- ハッシュ比較を使用して効率的に重複画像を検出します。
- ログ機能を備え、すべての処理内容を記録します。
- 重複した画像の削除・移動・ハードリンクするオプションを提供します。

- ハッシュ比較を使用して効率的に重複画像を検出します。
- 指定したディレクトリの操作が可能なコマンドラインインターフェース（CLI）を提供します。
- 検出された重複や処理内容をログに出力します。
- JPEGやPNGなどの主要な画像フォーマットに対応しています。

## 動作環境

このプロジェクトを動作させるには、以下の環境が必要です：

1. **Python 3.8以降**
   - Python がインストールされていることを確認してください。
   - 以下のコマンドでバージョンを確認できます：

     ```bash
     python3 --version
     ```

2. **Node.js と npm**
   - Node.js と npm がインストールされていることを確認してください。
   - 以下のコマンドでバージョンを確認できます：

     ```bash
     node -v
     npm -v
     ```

   - インストールされていない場合は、Node.js サイトの「[Node.js®をダウンロードする](https://nodejs.org/ja/download)」を参照して、node と npm をインストールしてください。

## 初期設定

以下のコマンドを実行して、プロジェクトの初期設定を行います。

```bash
. ./setup.sh
```

 *注意**: `./setup.sh` ではなく、必ず `. ./setup.sh` または `source ./setup.sh` を使用してください。  
これは、スクリプト内で仮想環境を有効化するために、現在のシェルでスクリプトを実行する必要があるためです。

このスクリプトは以下を自動で行います：

1. Python 仮想環境の作成と有効化。
2. 必要な Python パッケージのインストール。
3. 必要な Node.js パッケージのインストール。
4. TypeScript のコンパイル。

## インストール手順

1. このリポジトリをクローンしてください。

    ```bash
    git clone https://github.com/karoshima/dupimg.git
    ```

2. プロジェクトのディレクトリに移動してください。

    ```bash
    cd dupimg
    ```

3. 初期設定スクリプトを実行してください。

    ```bash
    . ./setup.sh
    ```

## 使い方

以下のコマンドを実行して Web サーバーを起動してください。

```bash
python3 app.py
```

- `/path/to/images` は、処理したい画像が含まれるディレクトリに置き換えてください。
- 検出された重複画像はログに記録されます。また、削除または別のディレクトリに移動するオプションが利用可能です。
- サーバー起動後、ブラウザで以下の URL にアクセスしてください:
  - <http://localhost:5000> (デフォルト設定の場合)
  - カスタムホストやポートを指定する場合は以下のように実行してください:

    ```bash
    python3 app.py --host 127.0.0.1 --port 8080
    ```

    上記の例では、ブラウザで <http://127.0.0.1:8080> にアクセスしてください。

## クリーンアップ

以下のコマンドを実行して、プロジェクトのクリーンアップを行います。

```bash
. ./cleanup.sh
```

このスクリプトは以下を自動で行います：

1. 仮想環境が有効化されている場合は無効化。
2. Python 仮想環境 (`venv`) の削除。
3. Node.js パッケージ (`node_modules`) の削除。
4. TypeScript のコンパイル結果 (`static/js`) の削除。

## ディレクトリ構成

以下はプロジェクトのディレクトリ構成です。

```plaintext
dupimg/
│
├── README.md              # プロジェクトの概要と使用方法
├── requirements.txt       # 必要なPythonライブラリ
├── app.py                 # Webサーバーのエントリーポイント
├── static/                # フロントエンドの静的ファイル（CSSやJavaScript）
│   ├── css/
│   │   └── styles.css     # 共通のスタイルシート
│   ├── js/
│   │   └── scripts.js     # コンパイルされたJavaScript
│   └── ts/
│       └── scripts.ts     # TypeScript ソースコード
├── templates/             # フロントエンドのHTMLテンプレート
│   ├── index.html         # 初期ページ
│   ├── settings.html      # 対象ディレクトリ設定ページ
│   ├── progress.html      # 検出中ページ
│   ├── results.html       # 検出結果ページ
│   └── trash.html         # ごみ箱ページ
├── utils/
│   ├── __init__.py        # ユーティリティの初期化
│   ├── image_processor.py # 画像比較ロジック
│   ├── logger.py          # ログ出力のユーティリティ
├── tests/
│   ├── test_image_processor.py # ユニットテスト
│   ├── __init__.py            # テストモジュールの初期化
├── output/                # 処理済みまたは重複画像の出力ディレクトリ
└── examples/              # サンプル入力および出力
```

## 貢献方法

プロジェクトへの貢献を歓迎しています。拡張したい場合は、リポジトリをフォークしてプルリクエストを送信してください。

## ライセンス

このプロジェクトはMITライセンスの下で提供されています。詳細については、`LICENSE`ファイルをご確認ください。
